<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
        <title>Notimo</title>
        <link rel="stylesheet" href="js/jquery.mobile-1.4.5.min.css" />
		<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
		<!-- <link rel="stylesheet" href="css/themes/notimo.css" /> -->
		<link rel="stylesheet" href="css/themes/bien.css" />
  		<link rel="stylesheet" href="css/themes/jquery.mobile.icons.min.css" />
  		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css" /> 
		<script type="text/javascript" src="js/jquery.mobile-1.4.5.min.js"></script>
		<script src="js/jquery.slides.min.js"></script>
        <script type="text/javascript" src="cordova.js"></script>

	
		<script>
		$( document ).bind( "mobileinit", function() {
		    // Make your jQuery Mobile framework configuration changes here!
		    $.mobile.allowCrossDomainPages = true;
			$.support.cors = true;
		});
		function verif_link(chaine){
			var Resultat = chaine.substring(0,3);
			if (Resultat == "www" )
				{chaine = "http://"+chaine+"" };
			return chaine;
			//place = chaine.indexOf("http://",0);
			
		}

		function getParamValue(param,url)
		{
			var u = url == undefined ? document.location.href : url;
			var reg = new RegExp('(\\?|&|^)'+param+'=(.*?)(&|$)');
			matches = u.match(reg);
			return matches[2] != undefined ? decodeURIComponent(matches[2]).replace(/\+/g,' ') : '';
		}
		
		// function check_image_dirigeant(cat){
		// 	$(".imgdirigeant").error(function () {
		// 	  $(this).unbind("error").attr("src", "images/dirigeant/cat"+cat+"_erreur.jpg");
		// 	});
		// };
		// function check_image_logo(){
		// 	$(".imglogo").error(function () {
		// 	  $(this).unbind("error").attr("src", "images/logo/cat_erreur.jpg");
		// 	});
		// };

		function espace_tel(letel) {
			letel= letel.replace(/ /g,"");
			return letel;
		}
		function test_zone(adresse){
			var resultat = adresse.indexOf('BP');
			if (resultat >= 0){
				var test1 = true;
				//alert (adresse+"test1="+test1);
			};
			resultat = adresse.indexOf('PAE');
			if (resultat >= 0){
				var test2 = true;
				//alert (adresse+"test2="+test2);
			};
			resultat = adresse.indexOf('ZA');
			if (resultat >= 0){
				var test3 = true;
				//alert ("adresse+test3="+test3);
			};
			resultat = adresse.indexOf('ZAC');
			if (resultat >= 0){
				var test4 = true;
			};
			resultat = adresse.indexOf('ZI');
			if (resultat >= 0){
				var test5 = true;
			};
			resultat = adresse.indexOf('ZAE');
			if (resultat >= 0){
				var test6 = true;
			};
			if (test1 || test2 || test3 || test4 || test5 || test6 == true){
				return true;	
			} else {
				return false;	
			};
		}

		function decodeHtml(html) {
		    var txt = document.createElement("textarea");
		    txt.innerHTML = html;
		    return txt.value;
		}

		function google_maps(GpsLatitudeFloue,GpsLongitudeFloue){
			//adresse_final = "http://maps.google.com/maps?q=";
			adresse_final = "http://maps.google.com/?q=";
			adresse_final += GpsLatitudeFloue+","+GpsLongitudeFloue;
			console.log (GpsLatitudeFloue+","+GpsLongitudeFloue)
			return adresse_final; 
			 
		}

		function verif(data) {
			data= data.replace(/''/g,"'");
			return data;
		};

		function switchTypeBien(typeBien){
			switch (typeBien) {
				case "APPT":
			        return "appartement";
			        break;
			    case "MAIS":
			        return "maison";
			        break;
			    case "IMMR":
			        return "immeuble";
			        break;
			    case "GARA":
			        return "garage";
			        break;
			    case "PARK":
			        return "parking";
			        break;
			    case "FDCO":
			        return "fond de commerce";
			        break;
			    case "LOCP":
			        return "locaux professionnels";
			        break;
			    case "BURE":
			        return "bureaux";
			        break;
			    case "TEBA":
			        return "terrains à bâtir";
			        break;
			    case "BAGR":
			        return "terrain agricole";
			        break;
			    case "BOIS":
			        return "bois/foret";
			        break;
			    case "ETAN":
			        return "étang/marais";
			        break;
			    case "TLOI":
			        return "terrain de loisir";
			        break;
			    case "PROP":
			        return "propriété";
			        break;
			    case "PROV":
			        return "propriétés viticoles";
			        break;
			    case "NEUF":
			        return "programmes neufs";
			        break;
			    case "DIVE":
			        return "divers / autres";
			        break;
		    };
		};

		function calculDpe(DpeNrj){
			if (DpeNrj<=50) {
				return "A";
			}
			if ((DpeNrj>=51)&&(DpeNrj<=90)) {
				return "B";
			}
			if ((DpeNrj>=91)&&(DpeNrj<=150)) {
				return "C";
			}
			if ((DpeNrj>=151)&&(DpeNrj<=230)) {
				return "D";
			}
			if ((DpeNrj>=231)&&(DpeNrj<=330)) {
				return "E";
			}
			if ((DpeNrj>=331)&&(DpeNrj<=450)) {
				return "F";
			}
			if ((DpeNrj>450)) {
				return "G";
			}

		};

		function calculGes(DpeGes){
			if (DpeGes<=5) {
				return "A";
			}
			if ((DpeGes>=6)&&(DpeGes<=10)) {
				return "B";
			}
			if ((DpeGes>=11)&&(DpeGes<=20)) {
				return "C";
			}
			if ((DpeGes>=21)&&(DpeGes<=35)) {
				return "D";
			}
			if ((DpeGes>=36)&&(DpeGes<=55)) {
				return "E";
			}
			if ((DpeGes>=56)&&(DpeGes<=80)) {
				return "F";
			}
			if ((DpeGes>80)) {
				return "G";
			}

		};

		function trueFalse(trueFalse){
			if (trueFalse == 'true'){
				return "oui";
			};
			if (trueFalse == 'false'){
				return "non";
			};
		}

		$(document).ready(function(){

			var id = getParamValue('id');		
			console.log(parseInt(id));	
		    var output = $("#successfullStatements_fiche");
		    var slides = $("#slides");
			var successfullStatements = $("#successfullStatements_fiche"),
				errors = $("#errors")
			successfullStatements.append('<br><p align="center">chargement</p>');	
					 
			$.ajax({
				url: 'http://notimo-appli.com/php/ficheBien.php?id='+id,
				dataType: 'jsonp',
				jsonp: 'jsoncallback',
				timeout: 5000,
				success: function(data, status){
					output.empty();
					$.each(data, function(i,item){
					 	 successfullStatements.empty();
						 var fiche = ''
						 var diapo = ''
							//fiche += '<img class="imglogo" src="http://btp74.com.linux.oxianet.com/btp74/images/logo/'+identifiantentreprise+item.cleentreprise+'_small.jpg" >'
							
							if (item.Titre.length > 0){fiche += '<h1>'+verif(item.Titre)+'</h1>'}
							if (item.Annonce.length > 0){fiche += verif(item.Annonce)}
							//if (item.commune.length > 0){fiche += '<br><h2>'+verif(item.cp)+' '+verif(item.commune)+'</h2>'}
							
							if (item.natureMaison.length > 0){fiche += '<br>Type : '+verif(item.natureMaison)}
							
							if ((item.aRenover.length > 0) && (item.aRenover == "true")){fiche += '<br><br>A rénover'}

							//photos
							if (item.Photo0.length > 0){fiche += '<br><br><img class="photoBien" src="http://notimo-appli.com/data/'+item.Photo0+'" >'}
							// if (item.Photo1.length > 0){fiche += '<br><br><a href="index.html" data-role="button">Plus de photos</a><br>'}
							if (item.typeBien.length > 0){fiche += '<span class="title">Type de bien : </span>'+switchTypeBien(item.typeBien)+'<br>'}
							if (item.commune.length > 0){fiche += '<span class="title">Situation : </span>'+verif(item.commune)+'('+item.departement+')'+'<br>'}
							if (item.NbreChambre.length > 0){fiche += '<span class="title">Nombre de Chambres : </span>'+item.NbreChambre+'<br>'}
							if (item.NbrePiece.length > 0){fiche += '<span class="title">Nombre de Pièces : </span>'+item.NbrePiece+'<br>'}
							if (item.SurfaceHabitable.length > 0){fiche += '<span class="title">Surface Habitable : </span>'+item.SurfaceHabitable+' m²<br>'}	
							//if (item.SurfaceHabitable.length > 0){fiche += '<span class="title">Ancien / Neuf : </span>'+item.SurfaceHabitable+'<br>'}
							// Etat : Neuf
							if (item.DpeNrj.length > 0){fiche += '<span class="title">Classification DPE : </span>'+calculDpe(item.DpeNrj)+'<br>'}
							if (item.DpeGes.length > 0){fiche += '<span class="title">Classification GES : </span>'+calculGes(item.DpeGes)+'<br>'}
							// Type : APPARTEMENT STANDARD
							// Situation Locative : LIBRE
							if (item.ascenseur.length > 0){fiche += '<span class="title">Ascenceur : </span>'+ trueFalse(item.ascenseur)+'<br>'}
							if (item.balcon.length > 0){fiche += '<span class="title">Balcon : </span>'+ trueFalse(item.balcon)+'<br>'}
							if (item.terrasse.length > 0){fiche += '<span class="title">Terrasse : </span>'+ trueFalse(item.terrasse)+'<br>'}
							//if (item.cave.length > 0){fiche += '<span class="title">Cave : </span>'+ trueFalse(item.cave)+'<br>'}
							if (item.etage.length > 0){fiche += '<span class="title">Etage : </span>'+ item.etage+'<br>'}
							// Cuisine Equipée : 
							if (item.piscine.length > 0){fiche += '<span class="title">Piscine : </span>'+ trueFalse(item.piscine)+'<br>'}

							if ((item.GpsLatitudeFloue.length)&&(item.GpsLongitudeFloue.length) > 0){
								fiche += '<li><a href="#" data-role="button" rel="external" target="_blank" onclick="window.open(\''+google_maps(item.GpsLatitudeFloue,item.GpsLongitudeFloue)+'\', \'_system\', \'location=yes\');">Localiser</a></li>'}	
							if (item.Photo0.length > 0){diapo += '<img class="photoBien" src="http://notimo-appli.com/data/'+item.Photo0+'" >'}
							if (item.Photo1.length > 0){diapo += '<img class="photoBien" src="http://notimo-appli.com/data/'+item.Photo1+'" >'}
							if (item.Photo2.length > 0){diapo += '<img class="photoBien" src="http://notimo-appli.com/data/'+item.Photo2+'" >'}
							if (item.Photo3.length > 0){diapo += '<img class="photoBien" src="http://notimo-appli.com/data/'+item.Photo3+'" >'}
							if (item.Photo4.length > 0){diapo += '<img class="photoBien" src="http://notimo-appli.com/data/'+item.Photo4+'" >'}			
							if (item.Photo5.length > 0){diapo += '<img class="photoBien" src="http://notimo-appli.com/data/'+item.Photo5+'" >'}	
							if (item.Photo6.length > 0){diapo += '<img class="photoBien" src="http://notimo-appli.com/data/'+item.Photo6+'" >'}	
							if (item.Photo7.length > 0){diapo += '<img class="photoBien" src="http://notimo-appli.com/data/'+item.Photo7+'" >'}	
							if (item.Photo8.length > 0){diapo += '<img class="photoBien" src="http://notimo-appli.com/data/'+item.Photo8+'" >'}	
							if (item.Photo9.length > 0){diapo += '<img class="photoBien" src="http://notimo-appli.com/data/'+item.Photo9+'" >'}	
							if (item.Photo10.length > 0){diapo += '<img class="photoBien" src="http://notimo-appli.com/data/'+item.Photo10+'" >'}	
							if (item.Photo11.length > 0){diapo += '<img class="photoBien" src="http://notimo-appli.com/data/'+item.Photo11+'" >'}	
							if (item.Photo12.length > 0){diapo += '<img class="photoBien" src="http://notimo-appli.com/data/'+item.Photo12+'" >'}	
							if (item.Photo13.length > 0){diapo += '<img class="photoBien" src="http://notimo-appli.com/data/'+item.Photo13+'" >'}	
							if (item.Photo14.length > 0){diapo += '<img class="photoBien" src="http://notimo-appli.com/data/'+item.Photo14+'" >'}													
										
		  					

						
							// if (item.codepostalsiege.length > 0){fiche += '<p>'+item.codepostalsiege+' <strong>'+verif(item.villesiege)+'</strong></p><br>'}
							
				
								
							// if (item.telephonesiege.length > 0){fiche +='<li><a href="tel:'+espace_tel(item.telephonesiege)+'" data-role="button" rel="external" target="_blank">tel:'+espace_tel(item.telephonesiege)+'</a></li>'} 
							// fiche  += ''
							// if (item.mailsiege.length > 0){fiche +='<li><a href="mailto:'+item.mailsiege+'">'+item.mailsiege+'</a></li>'}
							// //if (item.siteinternet.length > 0){fiche +='<li><a href="'+verif_link(item.siteinternet)+'" rel="external" target="_blank">'+item.siteinternet+'</a></li>'}
							// if (item.siteinternet.length > 0){
							// 	fiche +='<li><a href="#" rel="external" target="_blank" onclick="window.open(\''+verif_link(item.siteinternet)+'\', \'_system\', \'location=yes\');">'+item.siteinternet+'</a></li>'}
								
							// fiche  += '<br>'
							// if (item.faxsiege.length > 0){fiche += '<p><u>Fax:</u> '+item.faxsiege+'</p>'}
							// if (item.libellechambregeographique.length > 0){fiche +='<p><u>Libellé géographique:</u> <br>'+verif(item.libellechambregeographique)+'</p>'}
							
							// fiche += '<br><p><u>ACTIVITES</u></p>'
							// fiche += '<div id="activite">'
							// if (item.libelleactivite1.length > 0){fiche += '<p>'+verif(item.libelleactivite1)+'</p>'}
						
							
							// if ((item.nomindividu.length > 0) && (item.prenomindividu != null)){fiche += '<h1>'+verif(item.prenomindividu)+' '+item.nomindividu+'</h1>'}
							// if (item.libellefonctionentreprise.length > 0) {fiche += '<p>'+verif(item.libellefonctionentreprise)+'</p>'}
							// if (item.envoifaxinterlocuteur.length > 0){fiche += '<br><p><u>Fax:</u> '+item.envoifaxinterlocuteur+'</p><br>'}
							// if (item.telephonesiege.length > 0){fiche += '<li><a href="tel:'+espace_tel(item.telephonesiege)+'" data-role="button" rel="external" target="_blank" >tel:'+espace_tel(item.telephonesiege)+'</a></li>'} 
							// //if (item.envoimailinterlocuteur.length > 0){fiche += '<li><a href="mailto:'+item.envoimailinterlocuteur+'" data-role="button" rel="external">'+item.envoimailinterlocuteur+'</a></li>'}
							// if (item.effectif.length > 0){fiche += '<br><div id="cadre2"><p class="color">Effectif: </p></div><div id="effectif">'+effectif(item.effectif)+'<div>'}; 
							
						successfullStatements.append(fiche);
						slides.append(diapo);
						$(function(){
			      		$("#slides").slidesjs({
			        			width: 940,
			        			height: 528,
			        			 play: {
						          active: true,
						          auto: true,
						          interval: 4000,
						          swap: true
						        }
			      			});
			    		});
						 //changecss(cat);	
						 output.listview("refresh");
						 $('#successfullStatements_fiche a[data-role=button]').button();
						 //check_image_dirigeant(cat);
						 //check_image_logo();

						 //recup_clientele(parseInt(id));
						 //recup_rge(parseInt(id));
						 
						 
						 //successfullStatements.listview("refresh");
							 
						});
				},
				error: function(request, error){
					
					output.text('Problème avec les données.');
					output.append('Problème avec les données.');
					errors.append("<li>"+error.message+" Occured while processing: "+statement+"</li>");
				}
			});
		   
		});
		</script>
    </head>
    <body>


    	<div data-role="page" data-theme="a">
		<div data-role="header" data-position="inline">
			<h1></h1>
		</div>
		<a href="#" data-role="button"  data-rel="back" data-icon="arrow-l" data-theme="c" data-inline="true" >Retour</a>
		<div data-role="content">
        <div id="successfullStatements_fiche" data-role="listview" ></div>
        <div id="slides"></div>
		<ul id="errors"></ul>
	</div>
	</div>
    </body>
</html>
